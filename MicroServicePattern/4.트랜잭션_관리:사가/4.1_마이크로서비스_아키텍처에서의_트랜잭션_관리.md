# 4.1 마이크로서비스 아키텍처에서의 트랜잭션 관리

단일 DB에 접근하는 모놀리식 애플리케이션의 트랜잭션 관리는 어렵지 않지만 다중 DB, 다중 메시지 브로커를 사용하는 모놀리식 애플리케이션, 자체 DB를 가진 여러 서비스로 구성된 마이크로 서비스 아키텍쳐는 트랜잭션 관리가 어려워 좀 더 정교한 매커니즘이 필요.

<br />

## 4.1.1 분산 트랜잭션의 필요성

-   여러 서비스의 데이터를 수정하는 메서드를 두고 서비스 간 데이터 일관성을 유지할 수 있는 수단이 필요.
    <img src="https://thebook.io/img/007035/157.jpg">

## 4.1.2 분산 트랜잭션의 문제점

-   NoSQL DB와 현대 메시지 브로커는 분산 트랜잭션을 지원하지 않음.
-   동기 IPC 형태라서 가용성이 떨어짐.
    -   에릭 브루어 CAP 정리
    -   요즘 아키텍처는 일관성보다 가용성을 더 우선시.

<br />

## 개념

-   에릭 브루어 CAP 이론(2000년): `분산 환경에서는 일관성(Consistency), 가용성(Availablity), 네트워크 파티션 허용(Tolerance to network Partition)의 3가지 특징 중 최대 두 가지만 만족할 수 있다`
    -   `Consistency`: 모든 노드는 같은 시간에 모든 고객에게 같은 데이터를 보여줘야 한다. 쓰기 동작이 완료된 후에 발생하는 읽기 동작에서는 마지막 데이터를 반환해야 한다.
    -   `Availabilty(가용성)`: 모든 고객은 항상 읽거나 쓸 수 있어야 한다. 특정 노드에 장애가 발생하여도 서비스는 가능해야 한다.
    -   `Partition Tolerance(파티션 허용차)`:
        -   네트워크 노드로 분산되어 있어도 시스템을 동작할 수 있어야 한다.
        -   노드간에 통신에 문제가 발생하여도 정상적으로 동작해야 한다.
        -   노드는 정상인데 네트워크 등과 같은 문제로 서로간에 연결이 끊어진 상황을 말하는 것.
