# 마이크로서비스 아키텍처 IPC 개요

## 3.1.1 상호 작용 스타일

### 클라이언트/서비스 상호 작용 스타일 분류

1. 일대일/일대다 여부
    - 일대일: 각 클라이언트 요청은 정확히 한 서비스가 처리.
    - 일대다 : 각 클라이언트 요청을 여러 서비스가 협동하여 처리.
2. 동기/비동기 여부
    - 동기(synchronous): 클라이언트는 서비스가 제 시간에 응답하리라 기대하고 대기 도중 블로킹할 수 있음.
    - 비동기(synchronous): 클라이언트가 블로킹하지 않음. 응답은 즉시 전송되지 않아도 된다.

<br />

### 일대일 상호 작용

-   요청/응답(request/response): 클라이언트는 서비스에 요청을 하고 응답을 기다림. 서비스가 서로 강하게 결합되는 상호 작용 스타일.
-   비동기 요청/응답: 클라이언트는 서비스에 요청을 하고 서비스는 비동기적으로 응답.
-   단방향 알림(one-way notification): 클라이언트는 서비스에 일방적으로 요청만 하고 서비스는 응답을 보내지 않음.

### 일대다 상호 작용

-   발행/구독(publish/subscribe): 클라이언트는 알림 메시지를 발행하고, 여기에 관심 있는 0개 이상의 서비스가 메시지를 소비
-   발행/비동기 응답(publish/async response): 클라이언트는 요청 메시지를 발행하고 주어진 시간 동안 관련 서비스가 응답하길 기다림.

<br />

## 3.1.2 마이크로서비스 API 정의

-   반드시 API를 먼저 설계하기
-   어떤 IPC를 선택하든, 서비스 API를 IDL(Interface Definition Language)로 정확하게 정의하기.
-   API는 어떤 IPC를 사용하느냐에 따라 내용이 결정.

## 3.1.3 API 발전시키기

-   마이크로서비스 애플리케이션은 클라이언트를 다른 서비스 팀이 개발한 경우가 대부분이기 때문에 서비스 API 변경이 어려움.
-   요즘은 유지보수할 때 서버를 내리지 않기 때문에 규칙적인 단계로 서비스를 업그레이드 하여 신구 버전을 동시에 실행.

### 시맨틱 버저닝

API 버저닝에 관한 유용한 지침서.

<br> MAJOR.MINOR.PATCH </br>

-   MAJOR: 하위 호환되지 않는 변경분을 API에 적용 시
-   MINOR: 하위 호환되는 변경분을 API에 적용 시
-   PATCH: 하위 호환되는 오류 수정 시

### 하위 호환되는 소규모 변경

<br>하위 호환되는 사항</br>
새 서비스에 적용해도 기존 클라이언트 역시 별 문제 없이 작동

-   옵션 속성을 요청에 추가
-   속성을 응답에 추가
-   새 작업을 추가

### 중대한 대규모 변경

일시에 클라이언트를 강제로 업그레이드하는 것은 불가하므로 일정 기간동안 서비스는 신구 버전 API를 모두 지원.

-   HTTP 기반의 REST API: URL에 메이저 버전 번호를 삽입
-   API 게이트웨이는 거의 반드시 버저닝된 API를 사용

## 3.1.4 메시지 포맷

-   IPC의 핵심은 메시지 교환
-   대부분의 메시지는 데이터를 담고 있기 때문에 데이터 포맷은 중요한 설계 결정 항목

### 텍스트 메시지 포맷

-   JSON, XML 등 텍스트 기반 포맷은 사람이 읽을 수 있고 자기 서술적 장점.
-   JSON: 네임트 프로퍼티
-   XML: 네임드 엘리먼트와 그 값을 모아 놓은 구조

#### 단점

-   메시지가 다소 길다.
-   모든 메시지에 속성 값 이외에 속성명이 추가되는 오버헤드
-   덩치가 큰 메시지는 텍스틀 ㄹ파싱하는 오버헤드

### 이진 메시지 포맷

-   프로토콜 버퍼와 아브로
-   메시지 구조 정의에 필요한 타입 IDL을 제공하며, 컴파일러는 메시지를 직렬화/역직렬화 하는 코드를 생성.
-   API 발전 측면에서는 프로토콜 버퍼가 더 용이

    <br />

## 개념 정리

-   IPC(Inter-Process-Communication) : 프로세스들 사이에 서로 데이터를 주고받는 행위
-   프로토콜 버퍼 : 구조화된 데이터를 직렬화하는 방식. 유선이나 데이터 목적으로 서로 통신할 프로그램을 개발할 때 용이
    -   [레퍼런스](https://jeong-pro.tistory.com/190)

<br />

## 질문사항

1.  `[page 106]` : 단뱡향 알림에서 `클라이언트는 서비스에 일방적으로 요청만 하고 서비스는 응답을 보내지 않는다` 라고 표기되어 있는데 이러한 케이스는 어떤 것이 있을까요?
