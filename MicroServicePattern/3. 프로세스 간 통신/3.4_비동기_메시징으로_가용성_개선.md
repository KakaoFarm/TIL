# 3.4 비동기 메시징으로 가용성 개선

## 3.4.1 동기 통신으로 인한 가용성 저하

REST는 너무 대중적인 IPC지만, 동기 프로토콜.
즉 애플리케이션 가용성이 저하될 수 밖에 없다.

-   시스템 작업의 가용성 = 그 작업이 호출한 서비스의 가용성을 모두 곱한 값.
-   더 먆은 서비스가 요청 처리에 개입할수록 가용성은 낮아진다.
-   가용성을 최대화하려면 동기 통신을 최소화.

<br />

## 3.4.2 동기 상호 작용 제거

### 비동기 상호 작용 스타일

-   서비스가 동기 호출 대신 비동기 메시징을 통해 서로 통신하면 가용성이 올라감.

### 데이터 복제

-   서비스 요청 처리에 필요한 데이터의 레플리카를 유지하는 방법.
-   ex) 소비자/음식점 서비스는 각자 데이터가 변경될 때마다 이벤트를 발행하고, 주문 서비스는 이 이벤트를 구독하여 자기 편 레플리카를 업데이트.
-   대용량 데이터의 레플리카를 만드는 것은 대단히 비효율적

### 응답 반환 후 마무리

1. 로컬에서 가용한 데이터만 갖고 요청 검증
2. 메시지를 OUTBOX 테이블에 삽입하는 식으로 DB를 업데이트
3. 클라이언트에 응답을 반환.

<img src="https://thebook.io/img/007035/151.jpg" width="100%">

<br />

만약 문제가 발생한다면?

-   주문 서비스는 계속 주문을 생성하고 클라이언트에 응답. 나중에 소비자 서비스가 재가동되면 큐에 쌓인 메시지를 처리해서 밀린 주문을 다시 검증.

<br />

## 질문사항

1. 레플리카를 사용할 시 자칫하면 모놀리식 아키텍처로 바뀔 수 도 있을 것 같은데, 현재의 데이터 복제 방식을 사용하는 케이스가 있을까요?
