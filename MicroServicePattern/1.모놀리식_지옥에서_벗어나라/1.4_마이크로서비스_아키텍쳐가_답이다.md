# 1.4 마이크로서비스 아키텍쳐가 답이다.

FTGO 애플리케이션은 품질 속성의 악화와 소프트웨어 전달속도(`관리성(mainainability)`, `확장성(extensibility)`,`테스트성(testability)`)에서 단점

마이크로서비스 아키텍처 : 애드리안 콕크로프트는 경계 컨텍스트(bounded context)가 있는, 느슨하게 결합된 엘리먼트로 구성된 서비스 지향 아키텍쳐라고 정의

<br />

## 1.4.1 확장 큐브와 마이크로서비스

### 확장큐브

-   x축 확장 : 다중 인스턴스에 고루 요청 부하 분산
-   z축 확장 : 요청 속셩별 라우팅
-   y축 확장 : 기능에 따라 애플리케이션을 서비스로 분해

    <img width= '100%' src="https://blog.kakaocdn.net/dn/cw8T6C/btqAI3Vo0j6/32mNPCRpWYsUvc7uJgZnTK/img.png">

#### x축 확장

일반적인 모놀리식 애플리케이션 확장 수단.

-   부하 분산기 뒷면에 애플리케이션 인스턴스를 N개 띄어 놓고 부한 분사기는 들어온 요청을 인스턴스에 고루 분해
-   애플리케이션 능력과 가용성을 개선

#### z축 확장

x축 확장방법에 인스턴스별로 주어진 데이터 하위 집합(subsets)만 처리하도록 설정하는 방법.

-   애플리케이션을 확장해서 증가하는 트랜책션 및 데이터 볼륨을 처리

#### y축 확장

모놀리식 애플리케이션을 여러 서비스로 쪼개는 방법.

-   애플리케이션을 여러 서비스로 분리하고 각 서비스는 특정 기능을 담당하며 x축/z축 확장으로 확장

<br />

## 1.4.2 마이크로 서비스는 모듈성을 갖고 있다.

### 모듈성

-   크고 복잡한 애플리케이션을 개발할 때 꼭 필요한 특성.
-   마이크로서비스 아키텍처는 서비스를 모듈성의 단위로 사용
-   다른 서비스 API를 우회하여 그 내부 클래스에 마음대로 들어오거나 사용 불가.
-   서비스를 빌딩 블록처럼 사용하여 독립적으로 배포/확장 가능

<br />

## 1.4.3 서비스마다 DB가 따로 있다.

-   서로 느슨하게 결합되어 있고 오직 API를 통해서만 통신
-   각자 자체 DB를 갖고 있다.
-   서비스가 서로 완전히 분리되어 있기 때문에, 다른 서비스가 DB락을 획득해 내 서비스를 블로킹 하는 일은 발생하지 않는다.

<br />

## 개념 정리

-   DB Lock : 데이터의 일관성을 보장하기 위한 방법.(데이터를 동시에 사용하게 해주는 기능)
    -   Shared Lock : 다른 사용자가 같이 읽는 것을 허용하지만 변경하는 것은 허용하지 않음. `ex) select`
    -   Exclusive Lock : 다른 사용자가 읽는 것, 변경하는 것을 모두 허용하지 않음.
        `ex) Insert, Update, Delete`
    -   [[출처 및 참고자료] SQL Lock이란?](https://syujisu.tistory.com/193)
-   Blocking : Lock 들의 경합(Race condition)이 발생하여 특정 세션이 작업을 진행하지 못하고 멈춰선 상태.
    -   해결방안 - SQL 문장에 가장 빠르게 실행되도록 - 트랜잭션을 가능한 짧게 정의 - 동일한 데이터를 동시에 변경하는 작업을 하지 않도록 - 대용량 작업일 시 작업단위를 쪼개거나, lock_timeout 최대 시간 설정

<br />

## 질문사항

### z축 확장: 요청 속성별 라우팅

1. 그림 1-5 의 경우 클라이언트로 부터 api가 호출 될 경우 userId에 따라 요청을 라우팅할 목적지를 결정 한다고 되어 있는데 실제로 userId를 기준으로 데이터 하위 집합을 나눠서 사용하는지 궁금합니다. 이렇게 설계하기 위해서는 맨처음부터 인스턴스의 하위 집합을 나누는 기준을 명확하게 나누고 설계가 들어가야 할 것 같은데 어떻게 접근하는 것이 좋을까요?
