# 7.1 API 조합 패턴 응용 쿼리

## 7.1.1 findOrder() 쿼리

findOrder()는 기본키로 주문 정보를 조회하는 메서드.

### 모놀리식 애플리케이션

-   전체 데이터가 하나의 DB에 있기 때문에 알기 쉽게 `SELECT` 문으로 여러 테이블을 조인해서 주문 내역을 조회

### 마이크로서비스 아키텍처

-   데이터가 여러 서비스에 뿔뿔이 흩어져 있기 때문에 클라이언트가 주문내역을 조회 시 모든 서비스에 요청을 보내야 함.

<b>ex)</b>

-   주문 서비스: 주문 기본 정보(주문 내역, 주문 상태 등)
-   주방 서비스: 음식점 관점의 주문 상태, 픽업 준비까지 예상 소요 시간
-   배달 서비스: 주문 배달 상태, 배달 예상 정보, 현재 배달원 위치
-   회계 서비스: 주문 지불 상태

<br />

## API 조합 패턴 개요

API 조합 패턴: 여러 서비스에 있는 데이터를 API를 통해 조회하고 그 결과를 조합하여 쿼리를 구현

-   API 조합기: 프로바이더(provider) 서비스를 쿼리하여 데이터를 조회
-   프로바이더 서비스: 최종 결과로 반환할 데이터의 일부를 갖고 있는 서비스

### API 조합기

-   웹 애플리케이션처럼 웹 페이지에 데이터를 렌더링하는 클라이언트
-   쿼리 작업을 API 끝점으로 표출한 API 게이트웨이
-   프런트엔드를 위한 백엔드 패턴의 변형

<br />

## 7.1.3 API를 조합 패턴으로 findOrder() 쿼리 구현

### 주문 검색 조합기

-   `GET` /orders/{orderId}
-   orderId로 네 서비스를 호출한 후 수신한 응답을 조인

### 4개의 서비스

-   주문 서비스: `GET` /orders/{orderId}
-   주방 서비스: `GET` /tickets?orderId={orderId}
-   배달 서비스: `GET` /deliveries?orderId={orderId}
-   회계 서비스: `GET` /charges?orderId={orderId}

주문 서비스는 기본키로 자신의 Order를 조회하고, 다른 서비스는 orderId를 외래키로 자신의 애그리거트를 조회
